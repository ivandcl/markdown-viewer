<Window x:Class="Axon.Markdown.Viewer.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        xmlns:vm="clr-namespace:Axon.Markdown.Viewer.ViewModels"
        mc:Ignorable="d"
        Title="Axon Markdown Viewer"
        Height="650"
        Width="900"
        Background="#1e1e1e"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="False"
        ResizeMode="CanResizeWithGrip"
        Icon="/app.ico">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32"
                      ResizeBorderThickness="5"
                      GlassFrameThickness="0"
                      CornerRadius="0"
                      UseAeroCaptionButtons="False"/>
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <!-- Estilos para el tema oscuro -->
        <Style TargetType="Menu">
            <Setter Property="Background" Value="#2d2d30"/>
            <Setter Property="Foreground" Value="#d4d4d4"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="0"/>
        </Style>

        <Style TargetType="MenuItem">
            <Setter Property="Background" Value="#2d2d30"/>
            <Setter Property="Foreground" Value="#d4d4d4"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border x:Name="Border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" SharedSizeGroup="Icon"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto" SharedSizeGroup="Shortcut"/>
                                    <ColumnDefinition Width="Auto" SharedSizeGroup="Arrow"/>
                                </Grid.ColumnDefinitions>

                                <ContentPresenter Grid.Column="1"
                                                  ContentSource="Header"
                                                  Margin="{TemplateBinding Padding}"
                                                  VerticalAlignment="Center"
                                                  RecognizesAccessKey="True"/>

                                <TextBlock Grid.Column="2"
                                           Text="{TemplateBinding InputGestureText}"
                                           Margin="16,0,0,0"
                                           VerticalAlignment="Center"
                                           Opacity="0.6"/>

                                <Path Grid.Column="3"
                                      x:Name="Arrow"
                                      Data="M 0,0 L 4,4 L 0,8 Z"
                                      Fill="{TemplateBinding Foreground}"
                                      Margin="8,0,4,0"
                                      VerticalAlignment="Center"
                                      Visibility="Collapsed"/>

                                <Popup x:Name="PART_Popup"
                                       IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                       Placement="Bottom"
                                       AllowsTransparency="True"
                                       Focusable="False"
                                       PopupAnimation="Fade">
                                    <Border Background="#2d2d30"
                                            BorderBrush="#3c3c3c"
                                            BorderThickness="1"
                                            Padding="0,2">
                                        <ItemsPresenter/>
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="Role" Value="TopLevelHeader">
                                <Setter TargetName="PART_Popup" Property="Placement" Value="Bottom"/>
                            </Trigger>
                            <Trigger Property="Role" Value="SubmenuHeader">
                                <Setter TargetName="Arrow" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="PART_Popup" Property="Placement" Value="Right"/>
                            </Trigger>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#3e3e42"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#808080"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Estilo para botones de la barra de t√≠tulo -->
        <Style x:Key="TitleBarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#d4d4d4"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="46"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#3e3e42"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#007acc"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Estilo especial para el bot√≥n de cerrar -->
        <Style x:Key="CloseButtonStyle" TargetType="Button" BasedOn="{StaticResource TitleBarButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#e81123"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#f1707a"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Separator">
            <Setter Property="Background" Value="#3c3c3c"/>
            <Setter Property="Height" Value="1"/>
            <Setter Property="Margin" Value="0,2"/>
        </Style>

        <Style TargetType="StatusBar">
            <Setter Property="Background" Value="#007acc"/>
            <Setter Property="Foreground" Value="#ffffff"/>
        </Style>

        <Style TargetType="TextBlock" x:Key="StatusTextBlock">
            <Setter Property="Foreground" Value="#ffffff"/>
            <Setter Property="Margin" Value="5,0"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <!-- Barra de t√≠tulo -->
            <RowDefinition Height="Auto"/>
            <!-- Men√∫ -->
            <RowDefinition Height="Auto"/>
            <!-- Toolbar TTS -->
            <RowDefinition Height="*"/>
            <!-- Contenido -->
            <RowDefinition Height="Auto"/>
            <!-- Barra de estado -->
        </Grid.RowDefinitions>

        <!-- Barra de t√≠tulo personalizada -->
        <Grid Grid.Row="0" Background="#2d2d30">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Icono y t√≠tulo -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="8,0">
                <Image Source="{StaticResource AppIcon}" Width="16" Height="16" Margin="0,0,8,0"/>
                <TextBlock Text="Axon Markdown Viewer"
                           Foreground="#d4d4d4"
                           VerticalAlignment="Center"
                           FontSize="12"/>
            </StackPanel>

            <!-- √Årea arrastrable -->
            <Border Grid.Column="1" Background="Transparent" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown"/>

            <!-- Botones de control de ventana -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Style="{StaticResource TitleBarButtonStyle}"
                        Click="MinimizeButton_Click"
                        ToolTip="Minimizar">
                    <Path Data="M 0,0 L 10,0" Stroke="#d4d4d4" StrokeThickness="1" VerticalAlignment="Center"/>
                </Button>
                <Button Style="{StaticResource TitleBarButtonStyle}"
                        Click="MaximizeButton_Click"
                        ToolTip="Maximizar">
                    <Path x:Name="MaximizePath" Data="M 0,0 L 10,0 L 10,10 L 0,10 Z" Stroke="#d4d4d4" StrokeThickness="1" Fill="Transparent"/>
                </Button>
                <Button Style="{StaticResource CloseButtonStyle}"
                        Click="CloseButton_Click"
                        ToolTip="Cerrar">
                    <Path Data="M 0,0 L 10,10 M 10,0 L 0,10" Stroke="#d4d4d4" StrokeThickness="1"/>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Men√∫ superior -->
        <Menu Grid.Row="1" Padding="0" WindowChrome.IsHitTestVisibleInChrome="True">
            <MenuItem Header="_Archivo">
                <MenuItem Header="_Abrir..."
                          InputGestureText="Ctrl+O"
                          Command="{Binding OpenFileCommand}"/>
                <MenuItem Header="_Recargar"
                          InputGestureText="F5"
                          Command="{Binding ReloadFileCommand}"/>
                <Separator/>
                <MenuItem Header="_Salir"
                          InputGestureText="Alt+F4"
                          Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="_Ver">
                <MenuItem Header="Acercar" InputGestureText="Ctrl++" Click="ZoomIn_Click"/>
                <MenuItem Header="Alejar" InputGestureText="Ctrl+-" Click="ZoomOut_Click"/>
                <MenuItem Header="Restablecer Zoom" InputGestureText="Ctrl+0" Click="ResetZoom_Click"/>
            </MenuItem>
            <MenuItem Header="A_yuda">
                <MenuItem Header="_Acerca de" Click="About_Click"/>
            </MenuItem>
        </Menu>

        <!-- Barra de herramientas TTS -->
        <ToolBarTray Grid.Row="2" Background="#2d2d30">
            <ToolBar Background="#2d2d30" BorderThickness="0">
                <!-- Botones de control -->
                <Button Command="{Binding StartReadingCommand}"
                        ToolTip="Reproducir (leer en voz alta)"
                        Background="#2d2d30"
                        BorderBrush="#3c3c3c"
                        Foreground="#d4d4d4"
                        Padding="8,4"
                        Margin="2">
                    ‚ñ∂ Reproducir
                </Button>

                <Button Command="{Binding PauseReadingCommand}"
                        ToolTip="Pausar lectura"
                        Background="#2d2d30"
                        BorderBrush="#3c3c3c"
                        Foreground="#d4d4d4"
                        Padding="8,4"
                        Margin="2">
                    ‚è∏ Pausar
                </Button>

                <Button Command="{Binding ResumeReadingCommand}"
                        ToolTip="Reanudar lectura"
                        Background="#2d2d30"
                        BorderBrush="#3c3c3c"
                        Foreground="#d4d4d4"
                        Padding="8,4"
                        Margin="2">
                    ‚ñ∂ Reanudar
                </Button>

                <Button Command="{Binding StopReadingCommand}"
                        ToolTip="Detener lectura"
                        Background="#2d2d30"
                        BorderBrush="#3c3c3c"
                        Foreground="#d4d4d4"
                        Padding="8,4"
                        Margin="2">
                    ‚èπ Detener
                </Button>

                <Separator Background="#3c3c3c" Margin="4,0"/>

                <!-- Velocidad -->
                <TextBlock Text="Velocidad:"
                           Foreground="#d4d4d4"
                           VerticalAlignment="Center"
                           Margin="8,0,4,0"/>
                <Slider Width="100"
                        Minimum="-10"
                        Maximum="10"
                        Value="{Binding SpeechRate}"
                        TickFrequency="1"
                        IsSnapToTickEnabled="True"
                        VerticalAlignment="Center"
                        Foreground="#007acc"/>

                <TextBlock Text="{Binding SpeechRate}"
                           Foreground="#d4d4d4"
                           VerticalAlignment="Center"
                           Width="25"
                           Margin="4,0,8,0"/>

                <Separator Background="#3c3c3c" Margin="4,0"/>

                <!-- Volumen -->
                <TextBlock Text="Volumen:"
                           Foreground="#d4d4d4"
                           VerticalAlignment="Center"
                           Margin="8,0,4,0"/>
                <Slider Width="100"
                        Minimum="0"
                        Maximum="100"
                        Value="{Binding SpeechVolume}"
                        TickFrequency="10"
                        IsSnapToTickEnabled="True"
                        VerticalAlignment="Center"
                        Foreground="#007acc"/>

                <TextBlock Text="{Binding SpeechVolume}"
                           Foreground="#d4d4d4"
                           VerticalAlignment="Center"
                           Width="30"
                           Margin="4,0,8,0"/>

                <Separator Background="#3c3c3c" Margin="4,0"/>

                <!-- Idioma -->
                <TextBlock Text="Idioma:"
                           Foreground="#d4d4d4"
                           VerticalAlignment="Center"
                           Margin="8,0,4,0"/>
                <ComboBox Width="80"
                          ItemsSource="{Binding AvailableLanguages}"
                          SelectedItem="{Binding SelectedLanguage}"
                          Background="#2d2d30"
                          Foreground="#d4d4d4"
                          BorderBrush="#3c3c3c">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock>
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding}" Value="es">
                                                <Setter Property="Text" Value="üá™üá∏ Espa√±ol"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}" Value="en">
                                                <Setter Property="Text" Value="üá∫üá∏ English"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <Separator Background="#3c3c3c" Margin="4,0"/>

                <!-- Voz -->
                <TextBlock Text="Voz:"
                           Foreground="#d4d4d4"
                           VerticalAlignment="Center"
                           Margin="8,0,4,0"/>
                <ComboBox Width="200"
                          ItemsSource="{Binding AvailableVoices}"
                          SelectedItem="{Binding SelectedVoice}"
                          DisplayMemberPath="DisplayName"
                          Background="#2d2d30"
                          Foreground="#d4d4d4"
                          BorderBrush="#3c3c3c"/>

                <Separator Background="#3c3c3c" Margin="4,0"/>

                <!-- Progreso -->
                <TextBlock Text="Progreso:"
                           Foreground="#d4d4d4"
                           VerticalAlignment="Center"
                           Margin="8,0,4,0"/>
                <ProgressBar Width="150"
                             Height="20"
                             Minimum="0"
                             Maximum="100"
                             Value="{Binding ReadingProgress}"
                             Background="#1e1e1e"
                             Foreground="#007acc"
                             BorderBrush="#3c3c3c"/>

                <TextBlock Text="{Binding ReadingProgress, StringFormat={}{0}%}"
                           Foreground="#d4d4d4"
                           VerticalAlignment="Center"
                           Width="40"
                           Margin="4,0,0,0"/>
            </ToolBar>
        </ToolBarTray>

        <!-- √Årea de contenido con WebView2 -->
        <Border Grid.Row="3"
                Background="#252526"
                BorderBrush="#3c3c3c"
                BorderThickness="0,1,0,1">
            <wv2:WebView2 x:Name="webView"
                          Source="about:blank"/>
        </Border>

        <!-- Barra de estado -->
        <StatusBar Grid.Row="4" Height="24">
            <StatusBarItem>
                <TextBlock Text="{Binding CurrentFileName}"
                           Style="{StaticResource StatusTextBlock}"/>
            </StatusBarItem>
            <Separator Width="1" Background="#ffffff" Opacity="0.3"/>
            <StatusBarItem>
                <TextBlock Text="{Binding CurrentFilePath}"
                           Style="{StaticResource StatusTextBlock}"
                           Opacity="0.8"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>

    <!-- Comandos de teclado -->
    <Window.InputBindings>
        <KeyBinding Key="O" Modifiers="Control" Command="{Binding OpenFileCommand}"/>
        <KeyBinding Key="F5" Command="{Binding ReloadFileCommand}"/>
    </Window.InputBindings>
</Window>
